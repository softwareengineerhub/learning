Мы через ssh подключились к удаленному серверу на котором уже установлен docker

далее мы хотим каждые такие 4 дроплета включить в swarm.

docker swarm init --advertise-addr 107.170.88.22

Появится сообщение с примером команды для присоединению к swarm

Нужно ее скопировать и зайти под ssh на другой дроплет
и вставить эту команду.

Пофвится сообщение, что This node joined a swarm as a worker

Теперь если зайдем на оба дроплета и напишем
docker info

увидим, что swarm: active

Если на ноде Leader ввести
docker node ls
увидим 2 ноды; 1 - Leader ;

Если на ноде Worker ввести
docker node ls
будет ошибка

Теперь добавим еще 1 Manager:
Для этого с ноды Leader:
docker swarm join-token manager

появится команда; копируем ее и вставляем в 3 дроплет

теперь с 3 дроплета запускаем команду
docker node ls
будет 3 ноды
1 Leader, 1 Reachable (Manager) и обин без статуса - это worker


Теперь хотим добавить еще 1 Worker.
Для этого с дроплета Leader
docker swarm join-token worker

в ответ придет команда - ее вставляем в 4 дроплет

------------------------------------------------------

Теперь мы хотим остановить 1 дроплет - Leader и посмотреть что получится.
Для этого на 1 дроплете
ps -ef | grep docker

kill -9 processid

и делаем рестарт
reboot -f



Теперь приходим в дроплет 3 (2 Manager) и вызываем
docker node ls

теперь дроплет1 рестартанулся, но Manager поменялись ролями.
Теперь дроплет 3 - Leader

Это показывает как failover работает







